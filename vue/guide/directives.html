<!DOCTYPE html>
<html lang="en">
    <head>
        <title>教练，我想学指令 - vue.js</title>
        <meta charset="utf-8">
        <meta name="description" content="Vue.js - Intuitive, Fast and Composable MVVM for building interactive interfaces.">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
        <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600|Lato|Inconsolata' rel='stylesheet' type='text/css'>
        <link rel="icon" href="/images/logo.png" type="image/x-icon">
        <script>
            window.PAGE_TYPE = "guide"
        </script>
        <link rel="stylesheet" href="/vue/css/page.css" type="text/css">

        <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46852172-1', 'vuejs.org');
  ga('send', 'pageview');
</script>
        <script src="/js/vue.min.js"></script>
    </head>
    <body>
        <div id="mobile-bar">
            <a class="menu-button"></a>
            <a class="logo" href="/"></a>
        </div>
        
        
            <div id="header">
    <a id="logo" href="/">
        <img src="/images/logo.png">
        <span>Vue.js</span>
    </a>
    <ul id="nav">
        <li><a href="/guide/" class="nav-link current">教程</a></li>
<li><a href="/api/" class="nav-link">API 参考</a></li>
<li><a href="/examples/" class="nav-link">例子</a></li>
<li><a href="/blog/" class="nav-link">Blog</a></li>
<li><a href="https://github.com/yyx990803/vue" target="_blank" class="nav-link">GitHub</a></li>
    </ul>
</div>
        

        <div id="main">
            
                
    <div class="sidebar">
    <ul class="main-menu">
        <li><a href="/guide/" class="nav-link current">教程</a></li>
<li><a href="/api/" class="nav-link">API 参考</a></li>
<li><a href="/examples/" class="nav-link">例子</a></li>
<li><a href="/blog/" class="nav-link">Blog</a></li>
<li><a href="https://github.com/yyx990803/vue" target="_blank" class="nav-link">GitHub</a></li>
    </ul>
    <div class="list">
        <h2>Guide</h2>
        <ul class="menu-root">
            
                <li><a href="/guide/installation.html" class="sidebar-link">Installation</a></li>
            
                <li><a href="/guide/index.html" class="sidebar-link">开始吧！马猴烧酒</a></li>
            
                <li><a href="/guide/directives.html" class="sidebar-link current">教练，我想学指令</a></li>
            
                <li><a href="/guide/filters.html" class="sidebar-link">我在学过滤器的道路上迷失了方向</a></li>
            
                <li><a href="/guide/list.html" class="sidebar-link">不是假发，是列表</a></li>
            
                <li><a href="/guide/events.html" class="sidebar-link">事件的监听</a></li>
            
                <li><a href="/guide/forms.html" class="sidebar-link">处理表单</a></li>
            
                <li><a href="/guide/computed.html" class="sidebar-link">燃烧小宇宙吧！计算属性！</a></li>
            
                <li><a href="/guide/transitions.html" class="sidebar-link">我要替天行道，增加动画效果</a></li>
            
                <li><a href="/guide/composition.html" class="sidebar-link">Composing Components</a></li>
            
                <li><a href="/guide/application.html" class="sidebar-link">Building Larger Apps</a></li>
            
                <li><a href="/guide/plugin.html" class="sidebar-link">Plugins</a></li>
            
            <li style="margin:10px 0 3px">
              <script data-gittip-username="yyx990803"
                data-gittip-widget="button"
                src="//gttp.co/v1.js"></script>
            </li>
        </ul>
    </div>
</div>

<div class="content guide with-sidebar">
    <h1>教练，我想学指令</h1>
    <div id="ad">
        <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=vuejs" id="_carbonads_js"></script>
    </div>
    <h2 id="概要">概要</h2>
<p>如果你之前没有用过 AngularJS ，你可能不清楚什么是 指令directive 。本质上，指令是一些特殊的记号来告知库对一个DOM元素做一些操作。在Vue.js 中，指令的概念比Angular中的更简单。一个Vue.js的指令只能以HTML属性前缀的形式出现，格式如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">element</span> <span class="attribute">prefix-directiveId</span>=<span class="value">"[arg:] ( keypath | expression ) [filters...]"</span>&gt;</span><span class="tag">&lt;/<span class="title">element</span>&gt;</span></div></pre></td></tr></table></figure>

<h2 id="一个简单的例子">一个简单的例子</h2>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">v-text</span>=<span class="value">"message"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></div></pre></td></tr></table></figure>

<p>这里前缀v是默认的。指令是 <code>text</code> ，对应的值则是<code>message</code>。当视图模型变更的时候，这个指令控制 Vue.js 按照 <code>message</code> 来更新div的文字内容 <code>textContent</code> 。</p>
<h2 id="行内表达式">行内表达式</h2>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">v-text</span>=<span class="value">"'hello ' + user.firstName + ' ' + user.lastName"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></div></pre></td></tr></table></figure>

<p>这里我们使用了一个计算表达式代替了一个单纯的属性键值。Vue.js 会自动的追踪表达式当中的属性，当变化时自动刷新指令。感谢同步批量更新，当多个属性变化时，一个表达式只会在每个时间周期更新一次。</p>
<p>你应该聪明的使用表达式，避免把太多逻辑写到你的模板当中，特别是有副作用的语句（事件监听表达式是例外）。为了阻止过量的模板当中加入逻辑，Vue.js 的行内表达式限制为 <strong>单行语句</strong> （译者注：这其实是懒得实现多行吧喂……）。如果想要绑定复杂的操作，使用计算属性代替之 <a href="/guide/computed.html">Computed Properties</a> 。</p>
<p class="tip">因为安全性的原因，在行内表达式中，你只能访问它的父元素和附近的视图模型中的属性和方法。</p>

<h2 id="参数">参数</h2>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">v-on</span>=<span class="value">"click : clickHandler"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></div></pre></td></tr></table></figure>

<p>一些指令需要在键值或者表达式前放置一个参数。在这个例子中 <code>click</code> 参数显示我们想要用 <code>v-on</code> 指令监听一个点击事件绑定视图模型实例中的 <code>clickHandler</code> 方法。</p>
<h2 id="过滤器">过滤器</h2>
<p>过滤器可以添加在指令键值或者表达式的后面，用于在 DOM 更新之前继续处理数据。过滤器通过一个简单竖杠(<code>|</code>)来声明。更多的细节请见 <a href="/guide/filters.html">Filters in Depth</a>.</p>
<h2 id="多重语句">多重语句</h2>
<p>你可以把使用相同指令的多个绑定合而为一到一个属性中，用逗号分离（译者注：类似json格式）：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">v-on</span>=<span class="value">"</span></span></div><div class="line">    click   : onClick,</div><div class="line">    keyup   : onKeyup,</div><div class="line">    keydown : onKeydown</div><div class="line">"&gt;</div><div class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></div></pre></td></tr></table></figure>

<h2 id="文字指令Literal_Directives">文字指令Literal Directives</h2>
<p>一些指令不会产生数据绑定，他们只是简单的把属性设置为文字字符串。举个例子 <code>v-component</code> 指令：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">v-component</span>=<span class="value">"my-component"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></div></pre></td></tr></table></figure>

<p>这里 <code>&quot;my-component&quot;</code> 不是一个数据属性，而是一个字符串ID，而Vue.js用它来寻找相应组件的构造函数。</p>
<p>从 Vue.js 0.10开始，你也可以在文字指令中使用 mustache 表达式了。这允许你动态的的生成你想要看到的组件：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">v-component</span>=<span class="value">"{&#123; isOwner ? 'owner-panel' : 'guest-panel' &#125;}"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></div></pre></td></tr></table></figure>

<p>然而，记住指令中的 mustache 表达式只能转化 <strong>一次</strong>。在指令被编译后，他就不再对数值变化起作用了。为了动态的在运行中实例化不同的组件，使用 <a href="/api/directives.html#v-view">v-view</a> 指令。</p>
<p>你可以在这个列表中找到所有的文字指令 <a href="/api/directives.html#Literal_Directives">API reference</a>。</p>
<h2 id="空指令">空指令</h2>
<p>有的指令不需要任何的属性值，他们只是简单的对元素运行一次。 举个例子 <code>v-pre</code> 指令:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">v-pre</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- markup in here will not be compiled --&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></div></pre></td></tr></table></figure>

<p>你可以在这个列表中找到所有的空指令 <a href="/api/directives.html#Empty_Directives">API reference</a>.</p>
<h2 id="写一个自定义指令">写一个自定义指令</h2>
<p>使用 <code>Vue.directive()</code> 方法，你可以注册一个全局的自定义指令，通过一个与指令id <strong>directiveID</strong> 关联的定义对象 <strong>definition object</strong> 。一个定义对象可以提供几个拦截函数（全都是自定义）：</p>
<ul>
<li><strong>bind</strong>: 当指令第一次绑定在元素上时访问一次。</li>
<li><strong>update</strong>: 当绑定数值变化时访问。更新值会以变量的形式提供。</li>
<li><strong>unbind</strong>: 当指令与元素解绑时访问。</li>
</ul>
<p><strong>例子</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">Vue.directive(<span class="string">'my-directive'</span>, {</div><div class="line">    bind: <span class="function"><span class="keyword">function</span> <span class="params">(value)</span> </span>{</div><div class="line">        <span class="comment">// do preparation work</span></div><div class="line">        <span class="comment">// e.g. add event listeners or expensive stuff</span></div><div class="line">        <span class="comment">// that needs to be run only once</span></div><div class="line">        <span class="comment">// `value` is the initial value</span></div><div class="line">    },</div><div class="line">    update: <span class="function"><span class="keyword">function</span> <span class="params">(value)</span> </span>{</div><div class="line">        <span class="comment">// do something based on the updated value</span></div><div class="line">        <span class="comment">// this will also be called for the initial value</span></div><div class="line">    },</div><div class="line">    unbind: <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>{</div><div class="line">        <span class="comment">// do clean up work</span></div><div class="line">        <span class="comment">// e.g. remove event listeners added in bind()</span></div><div class="line">    }</div><div class="line">})</div></pre></td></tr></table></figure>

<p>一旦注册，你可以这么使用 Vue.js 模板（你需要加一个 Vue.js 的前缀）：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">v-my-directive</span>=<span class="value">"someValue"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></div></pre></td></tr></table></figure>

<p>当你只需要 <code>update</code> 功能，你可以通过简单的定义对象代替之：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Vue.directive(<span class="string">'my-directive'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(value)</span> </span>{</div><div class="line">    <span class="comment">// this function will be used as update()</span></div><div class="line">})</div></pre></td></tr></table></figure>

<p>所有的拦截函数都会复制到实际的定义对象中 <strong>directive object</strong>，你可以通过这些函数访问他们的 <code>this</code> 环境。这些指令对象会提供一些有用的属性：</p>
<ul>
<li><strong>el</strong>: 指令绑定的元素。</li>
<li><strong>key</strong>: 绑定的键值，不包括参数和过滤器。</li>
<li><strong>arg</strong>: 可能提供的参数。</li>
<li><strong>expression</strong>: 没有压缩过的原生表达式。</li>
<li><strong>vm</strong>: 拥有这些指令的相关视图模型。</li>
<li><strong>value</strong>: 当前绑定的数值。</li>
</ul>
<p class="tip">你应该将所有的的属性作为只读并尽可能少的更改它们。你也可以让自定义指令和这些指令对象连接，但是要小心不要偶然的覆盖掉内部已有的那些。</p>

<p>一个使用了一些属性的自定义指令的例子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"demo"</span> <span class="attribute">v-demo</span>=<span class="value">"LightSlateGray : msg"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></div></pre></td></tr></table></figure>



<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">Vue.directive(<span class="string">'demo'</span>, {</div><div class="line">    bind: <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>{</div><div class="line">        <span class="keyword">this</span>.el.style.color = <span class="string">'#fff'</span></div><div class="line">        <span class="keyword">this</span>.el.style.backgroundColor = <span class="keyword">this</span>.arg</div><div class="line">    },</div><div class="line">    update: <span class="function"><span class="keyword">function</span> <span class="params">(value)</span> </span>{</div><div class="line">        <span class="keyword">this</span>.el.innerHTML =</div><div class="line">            <span class="string">'argument - '</span> + <span class="keyword">this</span>.arg + <span class="string">'&lt;br&gt;'</span> +</div><div class="line">            <span class="string">'key - '</span> + <span class="keyword">this</span>.key + <span class="string">'&lt;br&gt;'</span> +</div><div class="line">            <span class="string">'value - '</span> + value</div><div class="line">    }</div><div class="line">})</div><div class="line"><span class="keyword">var</span> demo = <span class="keyword">new</span> Vue({</div><div class="line">    el: <span class="string">'#demo'</span>,</div><div class="line">    data: {</div><div class="line">        msg: <span class="string">'hello!'</span></div><div class="line">    }</div><div class="line">})</div></pre></td></tr></table></figure>

<p><strong>结果</strong></p>
<p><div id="demo" v-demo="LightSlateGray : msg"></div></p>
<script>
Vue.directive('demo', {
    bind: function () {
        this.el.style.color = '#fff'
        this.el.style.backgroundColor = this.arg
    },
    update: function (value) {
        this.el.innerHTML =
            'argument - ' + this.arg + '<br>' +
            'key - ' + this.key + '<br>' +
            'value - ' + value
    }
})
var demo = new Vue({
    el: '#demo',
    data: {
        msg: 'hello!'
    }
})
</script>

<h3 id="生成文字和空指令">生成文字和空指令</h3>
<p>如果你在生成自定义指令的时候使用 <code>isLiteral: true</code> 或者 <code>isEmpty: true</code> ，所有的数据绑定工作将会跳过这个指令，此时只有 <code>bind()</code> 和 <code>unbind()</code> 才会调用。在文字指令中，表达式一直是解析过的，所以你可以访问一些信息比如 <code>this.expression</code>， <code>this.key</code> 和 <code>this.arg</code>。 对于空指令来说，即使表达式存在，Vue.js 也不会解析表达式。</p>
<p>例子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">v-literal-dir</span>=<span class="value">"foo"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></div></pre></td></tr></table></figure>



<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Vue.directive(<span class="string">'literal-dir'</span>, {</div><div class="line">    isLiteral: <span class="literal">true</span>,</div><div class="line">    bind: <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>{</div><div class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.expression) <span class="comment">// 'foo'</span></div><div class="line">    }</div><div class="line">})</div></pre></td></tr></table></figure>

<h3 id="生成一个函数指令">生成一个函数指令</h3>
<p>Vue.js 鼓励开发者将数据与行为分离，因此实例方法应该写在 <code>methods</code> 中而不是写在数据对象里。不然<br>，数据对象中的函数将会被无视，而普通指令将无法与他们绑定。</p>
<p>为了在你的自定义指令中通过 <code>methods</code> 获取函数，你需要设置 <code>isFn</code> 选项：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">Vue.directive(<span class="string">'my-handler'</span>, {</div><div class="line">    isFn: <span class="literal">true</span>, <span class="comment">// important!</span></div><div class="line">    bind: <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>{</div><div class="line">        <span class="comment">// ...</span></div><div class="line">    },</div><div class="line">    update: <span class="function"><span class="keyword">function</span> <span class="params">(handler)</span> </span>{</div><div class="line">        <span class="comment">// the passed in value is a function</span></div><div class="line">    },</div><div class="line">    unbind: <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>{</div><div class="line">        <span class="comment">// ...</span></div><div class="line">    }</div><div class="line">})</div></pre></td></tr></table></figure>

<p>通过设置 <code>isFn:true</code> 也可以使你的自定义指令接受行内表达式，就像 <code>v-on</code> 那样。</p>
<p>想要看到更多的综合性的例子，请自行阅读源码中的 <code>src/directives/</code> 部分。（译者注：作者你够懒……）</p>
<p>下一章节: <a href="/guide/filters.html">深入理解过滤器 Filters in Depth</a>.</p>

    <div class="footer">Caught a mistake or want to contribute to the documentation? <a href="https://github.com/vuejs/vuejs.org" target="_blank">Fork this site on Github</a>!</div>
</div>
            
        </div>

        
            <script src="/js/smooth-scroll.min.js"></script>
            <script src="/js/common.js"></script>
        

    </body>
</html>